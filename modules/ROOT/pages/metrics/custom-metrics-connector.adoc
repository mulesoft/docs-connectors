= Anypoint Custom Metrics Connector

ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

The Anypoint Custom Metrics connector enables you to send operational and business metric values from a hybrid application to Anypoint Monitoring, where the metrics can be visualized in real time using Custom Dashboards. 

Once the metrics are in a Custom Dashboard, you can filter and group the metrics along the included dimensions. You can include multiple custom and built-in metrics in a single dashboard visualization.

[NOTE] 
====
To use the Anypoint Custom Metrics connector, you must have a Titanium subscription. +
This feature is currently supported only for hybrid applications.
====

== Prerequistes

* Mule runtime engine 4.1.x
* xref:am-installing.adoc[Install the Anypoint Monitoring Agent]

== Use the Custom Metrics Connector

. Search Anypoint Exchange for the Anypoint Custom Metrics connector. +
The connector has one operation called "Send custom metric." +
You can configure the connector in Design Center or Anypoint Studio. In Design Center:
.. Select the Anypoint  
. Add the *Send Custom Metric* operation to your application flow. +
This image shows an example flow for custom metrics in Anypoint Studio. 
+
image:custom-metric-example-flow.png[]
. Click the *Send Custom Metric* operation to add values for the operation. 
. Enter the dimension for the metric:
.. In *Metric name*, enter a meaningful value, for example "sales." 
.. In *Enter contextual information* select *Edit inline* to enter the name and value for the dimension. 
.. Click the green plus on the left to enter the values.
.. In the *Dimension* dialog box, enter the *Name* and *Value* for the dimension.
.. Leave the *Collapsible* option with the default of *True*.
.. Click *Finish*. +
You can repeat these steps to add multiple key values.
. Enter the facts for the metric. Values for measurements are numerical.
.. In *Enter measurements* select *Edit inline* to enter the name and value for the metric.
.. In the *Fact* dialog box, enter a *Name* and numerical *Value* for the fact. +
[NOTE]
For facts, the value must always be numerical. This is not validated at design time, but it will cause a runtime exception once deployed.
.. Leave the *Collapsible* option with the default of *True*.
.. Click *Finish*. +
You can repeat these steps to add multiple key values. +
This image shows example values for a custom metric that tracks t-shirt sales.
+
image:custom-metrics-connector-config.png[]
+
Select the *Throw runtime exception on validation failure* option if you want the flow to break if invalid values are entered for the metric. If this option is left unchecked, an error will be logged, but the flow will not break.
. Deploy the application.
. In Anypoint Monitoring, xref:dashboard-custom-config.adoc[add a new custom dashboard] for the custom metric. +
This image shows an example of the configuration for a graph to display t-shirt sales.
+
image:custom-metric-custom-dashboard-config.png[]
+
[NOTE]
You will only see the custom metrics in the pre-populated metric selection drop-down lists once you have logged something for the custom metric. 
+
image:custom-metric-custom-dashboard-graph.png[]